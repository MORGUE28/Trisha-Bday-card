<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A Birthday Surprise!</title>

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎂</text></svg>">

  <!-- Social Media Preview Tags -->
  <meta property="og:title" content="A Special Birthday Surprise!">
  <meta property="og:description" content="I made a little something for you. Click the link to see!">
  <meta property="og:image" content="https://i.imgur.com/gFG4gSj.png">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-gradient: linear-gradient(135deg, #ffdeea 0%, #f2ffe5 100%);
      --accent-gradient: linear-gradient(90deg, #ff758c, #ff7eb3);
      --font-main:'Poppins', sans-serif;
      --font-typewriter:'Courier Prime', monospace;
    }
    *, *::before, *::after{box-sizing: border-box;}
    html, body {
      margin:0; padding:0; height:100%;
      font-family: var(--font-main);
      background: var(--bg-gradient);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      color: #102027;
      overflow: hidden;
    }
    .stage {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .shell {
      width: 98vw; /* Scales with viewport width */
      height: 98vh; /* Scales with viewport height */
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      touch-action: manipulation;
      background: rgba(255, 247, 248, 0.7);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border-radius: 22px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 22px 60px rgba(100,80,120,0.1);
    }

    .shape-blob {
      position: absolute;
      background: linear-gradient(135deg, rgba(255, 117, 140, 0.4), rgba(255, 126, 179, 0.2));
      border-radius: 50%;
      filter: blur(40px);
      z-index: -1;
    }
    .shape-blob.one {
      width: 400px; height: 400px;
      top: -150px; left: -150px;
    }
    .shape-blob.two {
      width: 300px; height: 300px;
      bottom: -100px; right: -100px;
      background: linear-gradient(90deg, rgba(255, 222, 234, 0.5), rgba(242, 255, 229, 0.5));
    }

    /* Page base */
    .page {
      width: 100%;
      height: 100%;
      position: absolute; inset: 0; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 28px 20px; gap: 24px;
      opacity: 0; pointer-events: none;
      transform: translateY(12px);
      transition: opacity 0.55s cubic-bezier(0.4, 0, 0.2, 1), transform 0.55s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .page.active { opacity: 1; pointer-events: auto; transform: translateY(0); }

    /* Headings */
    .title {
      font-weight: 800; font-size: 2.8rem;
      user-select: none; text-align: center; line-height: 1.1; margin: 0;
      color: #ff758c;
    }
    .title span span {
      background: var(--accent-gradient);
      background-clip: text; -webkit-background-clip: text; color: transparent;
    }
    .subtitle {
      font-weight: 600; font-size: 1.15rem; color: #7d7d7d;
      user-select: none; text-align: center; margin: 0 0 14px 0;
    }
    
    /* Page 1: Cake & Candles */
    .cake-area {
      display: flex; flex-direction: column; align-items: center;
      gap: 35px; width: 100%; max-width: 460px; user-select: none;
    }
    .cake-clip {
      width: 100%; height: 260px; border-radius: 20px;
      background: linear-gradient(180deg, #fff5f8, #ffe8ee);
      box-shadow: 0 18px 40px rgba(255, 110, 140, 0.12);
      position: relative; display: flex; align-items: flex-start;
      justify-content: center; padding-top: 38px;
    }
    .plate {
      width: 90%;
      max-width: 360px; height: 140px;
      background: linear-gradient(180deg,#fff3f6,#fff0f2);
      border-radius: 12px;
      box-shadow: inset 0 -12px 38px rgba(255, 160, 180, 0.38);
    }
    .candles {
      position: absolute; top: 6px; display: flex; gap: 14px;
      left: 50%; transform: translateX(-50%);
    }
    .candle {
      width: 22px; height: 66px; border-radius: 8px;
      background: linear-gradient(180deg,#fff8ea,#ffdde1);
      position: relative; cursor: pointer;
      transition: transform 0.2s ease; -webkit-tap-highlight-color: transparent;
    }
    .candle:active { transform: translateY(2px); }
    .flame {
      width: 14px; height: 20px; border-radius: 50%;
      position: absolute; top: -22px; left: 50%; transform: translateX(-50%);
      background: linear-gradient(180deg,#ffd86b,#ff6b6b);
      box-shadow: 0 0 15px rgba(255,120,120,0.4);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .flame.hidden { opacity: 0; transform: translateX(-50%) scale(0.5); }
    .wick {
      position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
      width: 3px; height: 8px; background: #4B3621; border-radius: 1px;
    }
    .smoke {
      position: absolute; top: -30px; left: 50%; opacity: 0;
      font-size: 22px; pointer-events: none; transition: all 0.8s ease;
    }
    .smoke.visible { opacity: 1; transform: translateY(-30px) translateX(-50%); }

    /* Page 2: Collage + Message */
    .surprise-title { font-size: 2.5rem; margin-bottom: 12px; }
    .content {
      display: flex; gap: 24px; width: 100%; max-width: 980px;
      align-items: center; justify-content: center; flex-wrap: wrap;
    }
    .collage-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px; /* Space between collage and caption */
      min-height: 450px;
    }
    .collage-caption {
      margin: 0;
      font-size: 13px;
      font-style: italic;
      color: #999;
      user-select: none;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 2px 5px;
      border-radius: 3px;
    }

    .collage {
      flex: 1 1 48%; min-width: 280px; height: 420px; position: relative;
      border-radius: 14px; padding: 12px;
      background: linear-gradient(180deg,rgba(255,250,248,0.8),rgba(255,246,242,0.8));
      box-shadow: 0 14px 40px rgba(255, 110, 140, 0.06);
      transition: transform 0.4s ease;
    }
    .collage img {
      position: absolute; border-radius: 14px;
      box-shadow: 0 14px 40px rgba(255, 110, 140, 0.1);
      object-fit: cover; border: 7px solid #fff;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .collage img:hover {
      transform: scale(1.05) rotate(var(--r, 0deg)) !important;
      box-shadow: 0 20px 45px rgba(255, 110, 140, 0.2);
      z-index: 10;
    }
    /* 10-photo layout */
    #c1{left: 2%; top: 5%; width: 30%; height: 40%; transform: rotate(-8deg); --r: -8deg;}
    #c2{left: 35%; top: 2%; width: 35%; height: 30%; transform: rotate(5deg); --r: 5deg;}
    #c3{left: 72%; top: 8%; width: 25%; height: 45%; transform: rotate(10deg); --r: 10deg;}
    #c4{left: 5%; top: 48%; width: 28%; height: 25%; transform: rotate(6deg); --r: 6deg;}
    #c5{left: 36%; top: 35%; width: 38%; height: 35%; transform: rotate(-5deg); --r: -5deg;}
    #c6{left: 77%; top: 56%; width: 20%; height: 25%; transform: rotate(-8deg); --r: -8deg;}
    #c7{left: 8%; top: 75%; width: 25%; height: 22%; transform: rotate(-10deg); --r: -10deg;}
    #c8{left: 36%; top: 73%; width: 35%; height: 25%; transform: rotate(4deg); --r: 4deg;}
    #c9{left: 74%; top: 83%; width: 24%; height: 15%; transform: rotate(12deg); --r: 12deg;}
    #c10{left: 55%; top: 65%; width: 20%; height: 20%; transform: rotate(-3deg); --r: -3deg;}

    .msg-box {
      flex: 1 1 48%; min-width: 260px; padding: 22px; border-radius: 16px;
      background: linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,254,252,0.9));
      box-shadow: 0 12px 30px rgba(12, 20, 30, 0.04);
      line-height: 1.6; display: flex; flex-direction: column; gap: 14px; height: 420px;
    }
    .msg-title { font-weight: 700; color: #ff4b6b; font-size: 22px; margin: 0; user-select: none; text-align: center; }
    .typewriter {
      font-family: var(--font-typewriter);
      font-size: 15.2px; white-space: pre-wrap;
      border-right: 2px solid #ff4b6b;
      padding-right: 6px;
      flex-grow: 1;
      height: 0;
      color: #2b2b2b;
      overflow-y: auto; text-align: justify;
    }
    .controls { display: flex; justify-content: center; align-items: center; margin-top: auto; gap: 12px; }
    .btn {
      background: linear-gradient(90deg, #ff5273, #ff7d9a); color: white;
      padding: 12px 22px; border-radius: 999px; border: none;
      font-family: var(--font-main); font-weight: 700; cursor: pointer;
      box-shadow: 0 10px 30px rgba(255, 110, 140, 0.22);
      user-select: none; -webkit-tap-highlight-color: transparent;
      transition: transform 0.2s ease;
    }
    .btn:active { transform: scale(0.97); }

    /* Page 3: Final screen */
    .final-wrap {
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      text-align: center;
      background: radial-gradient(circle at bottom, #ff5273, #ff7d9a 75%, #f5e0ea 100%);
      color: #fff;
    }
    .final-line {
      font-weight: 800; font-size: 2.8rem; line-height: 1.3;
      color: #fff; /* Fallback color */
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    .final-line span span {
      background: linear-gradient(90deg,#fff5f7,#ffdde7);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .final-line.animate {
        opacity: 1;
        transform: translateY(0);
    }
    .final-subtitle { font-size: 1.8rem; margin-top: 16px; font-weight: 600; color: #ffe4f1; }
    #restart { margin-top: 40px; box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15); }
    
    /* Lightbox styles */
    .lightbox {
        position: fixed; inset: 0; background: rgba(0,0,0,0.75);
        display: flex; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
        z-index: 1000; cursor: pointer;
    }
    .lightbox.show { opacity: 1; pointer-events: auto; }
    .lightbox img {
        max-width: 90vw; max-height: 85vh;
        border-radius: 12px; box-shadow: 0 0 50px rgba(0,0,0,0.5);
        cursor: default;
    }

    /* =========== RESPONSIVE STYLES (CORRECTED) =========== */
    @media (max-width: 768px) {
      .page {
        gap: 15px;
        padding: 20px 10px;
      }
      #page1, #page1-5, #page3 {
        justify-content: center;
      }
      #page2 {
        justify-content: flex-start;
      }

      .title, .final-line { font-size: 2.2rem; }
      .subtitle { font-size: 1rem; }
      .surprise-title { font-size: 2rem; margin-bottom: 0; flex-shrink: 0; }
      .final-subtitle { font-size: 1.2rem; }
      
      .cake-clip { height: 220px; }
      .candles { gap: 10px; }
      .candle { width: 18px; height: 55px; }
      .flame { width: 12px; height: 16px; top: -18px; }
      
      .content {
        flex-direction: column;
        gap: 20px;
        padding-bottom: 20px;
        flex-grow: 1; /* Allow content to fill space */
        min-height: 0; /* Flexbox fix for scrolling */
        overflow-y: auto; /* Make the content area scroll */
      }
      .collage {
        width: 100%;
        height: 280px;
        flex-shrink: 0;
        min-width: unset;
      }
      .msg-box {
        width: 100%;
        padding: 15px;
        height: auto;
        min-height: 200px;
        flex-shrink: 0;
      }

      .typewriter {
        font-size: 14px;
        line-height: 1.5;
      }
      .controls {
        margin-top: 15px;
      }
      .btn {
        padding: 10px 18px;
        font-size: 14px;
      }
    }
    
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      .flame, .lightbox {
        transition-duration: 0.4s !important;
      }
    }
  </style>
</head>
<body>

  <div class="shape-blob one"></div>
  <div class="shape-blob two"></div>

  <div class="stage">
    <div class="shell">

      <!-- Page 1 -->
      <section id="page1" class="page active">
        <div class="cake-area">
          <h1 class="title"><span>You're getting old... 👵🏻</span></h1>
          <p class="subtitle">Click the candles to make a wish! 🎂</p>
          <div class="cake-clip">
            <div class="candles" id="candles">
              <div class="candle"><div class="flame"></div><div class="wick"></div><div class="smoke">💨</div></div>
              <div class="candle"><div class="flame"></div><div class="wick"></div><div class="smoke">💨</div></div>
              <div class="candle"><div class="flame"></div><div class="wick"></div><div class="smoke">💨</div></div>
              <div class="candle"><div class="flame"></div><div class="wick"></div><div class="smoke">💨</div></div>
              <div class="candle"><div class="flame"></div><div class="wick"></div><div class="smoke">💨</div></div>
              <div class="candle"><div class="flame"></div><div class="wick"></div><div class="smoke">💨</div></div>
              <div class="candle"><div class="flame"></div><div class="wick"></div><div class="smoke">💨</div></div>
            </div>
            <div class="plate"></div>
          </div>
        </div>
      </section>

      <!-- Page 1.5 - Intermediate -->
      <section id="page1-5" class="page">
        <h1 class="title"><span>There's something hidden ahead... 🤔</span></h1>
        <button id="continue1-5" class="btn">I'm Ready!</button>
      </section>

      <!-- Page 2 -->
      <section id="page2" class="page">
        <h1 class="title surprise-title">Surprise! ✨</h1>
        <div class="content">
          <div class="collage tilt-effect" id="collage">
            <img src="./images/1.jpg" id="c1" alt="Memory 1">
            <img src="./images/2.jpg" id="c2" alt="Memory 2">
            <img src="./images/9.jpg" id="c3" alt="Memory 3">
            <img src="./images/4.jpg" id="c4" alt="Memory 4">
            <img src="./images/6.jpg" id="c5" alt="Memory 5">
            <img src="./images/3.jpg" id="c6" alt="Memory 6">
            <img src="./images/10.jpg" id="c7" alt="Memory 7">
            <img src="./images/5.jpg" id="c8" alt="Memory 8">
            <img src="./images/7.jpg" id="c9" alt="Memory 9">
            <img src="./images/8.jpg" id="c10" alt="Memory 10">
            <p class="collage-caption" style="position:absolute; bottom:8px; left:50%; transform:translateX(-50%);">
              Click any photo to enlarge 📸
            </p>
          </div>
          <div class="msg-box">
            <h2 class="msg-title">🥂 Here's to You 🥂</h2>
            <pre id="typewriter" class="typewriter"></pre>
            <div class="controls">
              <button id="continue2" class="btn" style="display: none;">Continue</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Page 3 -->
      <section id="page3" class="page">
        <div class="final-wrap">
          <h1 class="final-line"><span>Happy Birthday, <span id="name-2">Trisha</span>!</span> 🎉</h1>
          <p class="final-subtitle">Here’s to you, your day, and all the years we’ll keep celebrating together.</p>
          <button id="restart" class="btn">Restart</button>
        </div>
      </section>
      
      <div class="lightbox" id="lightbox">
        <img src="" alt="Enlarged memory photo" id="lightbox-img">
      </div>

      <audio id="bg-music" loop src="./bensound-sweet.mp3"></audio>

    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<script>
  (() => {
    const urlParams = new URLSearchParams(window.location.search);
    const recipientName = urlParams.get('name') || 'Trisha';

    const page1 = document.getElementById('page1');
    const page1_5 = document.getElementById('page1-5');
    const page2 = document.getElementById('page2');
    const page3 = document.getElementById('page3');
    const candlesContainer = document.getElementById('candles');
    const continueBtn1_5 = document.getElementById('continue1-5');
    const continueBtn2 = document.getElementById('continue2');
    const restartBtn = document.getElementById('restart');
    const audio = document.getElementById('bg-music');
    const typewriterEl = document.getElementById('typewriter');
    const collageContainer = document.getElementById('collage');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    
    document.getElementById('name-2').textContent = recipientName;
    document.title = `Happy Birthday, ${recipientName}!`;

    const candleCount = 7;
    let blownCount = 0;
    let musicStarted = false;

    function fadeAudio(toVol, duration = 2500) {
      const startVol = audio.volume;
      const startTime = performance.now();
      function step(now) {
        let elapsed = now - startTime;
        if (elapsed > duration) elapsed = duration;
        audio.volume = startVol + (toVol - startVol) * (elapsed / duration);
        if (elapsed < duration) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }
    
    function blowOutCandle(candleElement) {
      const flame = candleElement.querySelector('.flame');
      if (flame.classList.contains('hidden')) return;

      const smoke = candleElement.querySelector('.smoke');
      flame.classList.add('hidden');
      smoke.classList.add('visible');
      blownCount++;

      if (!musicStarted) {
        musicStarted = true;
        audio.volume = 0;
        audio.play().catch(e => console.error("Audio play failed:", e));
        fadeAudio(0.35 / candleCount);
      } else {
        const newVolume = audio.volume + (0.35 / candleCount);
        fadeAudio(Math.min(newVolume, 0.35), 600);
      }

      if (blownCount === candleCount) {
        setTimeout(() => {
          page1.classList.remove('active');
          page1_5.classList.add('active');
        }, 1200);
      }
    }

    candlesContainer.addEventListener('click', (event) => {
      const candle = event.target.closest('.candle');
      if (candle) {
        blowOutCandle(candle);
      }
    });

    continueBtn1_5.addEventListener('click', () => {
      page1_5.classList.remove('active');
      page2.classList.add('active');
      startTypewriter();
    });

    collageContainer.addEventListener('click', (e) => {
        if (e.target.tagName === 'IMG') {
            lightboxImg.src = e.target.src;
            lightbox.classList.add('show');
        }
    });
    
    lightbox.addEventListener('click', (e) => {
        if (e.target.id !== 'lightbox-img') {
            lightbox.classList.remove('show');
        }
    });

    continueBtn2.addEventListener('click', () => {
      page2.classList.remove('active');
      page3.classList.add('active');
      launchConfetti();
      setTimeout(() => {
        document.querySelector('#page3 .final-line').classList.add('animate');
      }, 300);
    });

    restartBtn.addEventListener('click', () => {
      fadeAudio(0, 1500);
      setTimeout(() => {
        audio.pause(); audio.currentTime = 0;
        blownCount = 0; musicStarted = false;
        
        document.querySelectorAll('.candle').forEach(c => {
          c.querySelector('.flame').classList.remove('hidden');
          c.querySelector('.smoke').classList.remove('visible');
        });
        
        continueBtn2.style.display = 'none';
        typewriterEl.textContent = '';
        lightbox.classList.remove('show');
        document.querySelector('#page3 .final-line').classList.remove('animate');
        
        page3.classList.remove('active');
        page1_5.classList.remove('active');
        page1.classList.add('active');
      }, 1600);
    });

    const message = `Happy 23rd, Chotee. You know, in life, people come and go. Friends fade, paths change… but somehow, you stayed. For seven years, you’ve been there for the big moments, the little ones, and the ones in between — from the lame jokes to serious arguments, listening to me, being honest even when it wasn’t easy, trusting me with the parts of you not everyone gets to see. You’re not just my best friend — you’re my only best friend. And if I’ve learned anything, it’s that when you find someone like that, you hold on. So here’s to holding on… always. 😊`;
    let typingInterval;

    function startTypewriter() {
      let idx = 0;
      typewriterEl.textContent = '';
      typewriterEl.style.borderRight = '2px solid #ff4b6b';
      continueBtn2.style.display = 'none';
      clearInterval(typingInterval);
      
      typingInterval = setInterval(() => {
        if (idx < message.length) {
          typewriterEl.textContent += message.charAt(idx++);
          typewriterEl.scrollTop = typewriterEl.scrollHeight;
        } else {
          clearInterval(typingInterval);
          typewriterEl.style.borderRight = 'none';
          continueBtn2.style.display = 'inline-block';
          continueBtn2.focus();
        }
      }, 30);
    }
    
    function launchConfetti() {
        if (typeof confetti !== 'function') return;
        const duration = 5 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 100 };

        function randomInRange(min, max) { return Math.random() * (max - min) + min; }

        const interval = setInterval(() => {
            const timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) return clearInterval(interval);
            
            const particleCount = 50 * (timeLeft / duration);
            confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
            confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
        }, 250);
    }

    const tiltElements = document.querySelectorAll('.tilt-effect');
    tiltElements.forEach(element => {
        element.addEventListener('mousemove', (e) => {
            const rect = element.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const rotateX = ((y - centerY) / centerY) * -7;
            const rotateY = ((x - centerX) / centerX) * 7;
            element.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        });
        element.addEventListener('mouseleave', () => {
            element.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
        });
    });

  })();
</script>

</body>
</html>


